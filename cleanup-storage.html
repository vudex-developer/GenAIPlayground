<!DOCTYPE html>
<html>
<head>
    <title>localStorage ì •ë¦¬ ë„êµ¬</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #0f141a;
            color: #e2e8f0;
        }
        button {
            background: #10b981;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #059669;
        }
        button.danger {
            background: #ef4444;
        }
        button.danger:hover {
            background: #dc2626;
        }
        .info {
            background: #1e293b;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 1px solid #334155;
        }
        .log {
            background: #0f172a;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        h1 { color: #10b981; }
        h2 { color: #60a5fa; }
    </style>
</head>
<body>
    <h1>ğŸ—„ï¸ localStorage ì •ë¦¬ ë„êµ¬</h1>
    
    <div class="info" id="info">
        <h2>ğŸ“Š í˜„ì¬ ìƒíƒœ</h2>
        <p id="status">í™•ì¸ ì¤‘...</p>
    </div>

    <div>
        <h2>ğŸ› ï¸ ì‘ì—…</h2>
        <button onclick="checkStorage()">ğŸ“Š ìš©ëŸ‰ í™•ì¸</button>
        <button onclick="backupWorkflow()">ğŸ’¾ ë°±ì—… (Export)</button>
        <button class="danger" onclick="clearStorage()">ğŸ—‘ï¸ localStorage ì •ë¦¬</button>
    </div>

    <div class="log" id="log"></div>

    <script>
        function log(message) {
            const logEl = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logEl.innerHTML += `[${time}] ${message}<br>`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        function checkStorage() {
            let total = 0;
            const items = [];
            
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    const size = (localStorage[key].length + key.length) * 2;
                    total += size;
                    items.push({
                        key,
                        sizeMB: (size / 1024 / 1024).toFixed(2),
                        size
                    });
                }
            }

            items.sort((a, b) => b.size - a.size);

            const mb = (total / 1024 / 1024).toFixed(2);
            const limit = 5;
            const percentage = Math.min((total / (limit * 1024 * 1024)) * 100, 100);

            document.getElementById('status').innerHTML = `
                <strong>ì´ ì‚¬ìš©ëŸ‰:</strong> ${mb} MB / ${limit} MB (${percentage.toFixed(1)}%)<br><br>
                <strong>í•­ëª©ë³„ í¬ê¸°:</strong><br>
                ${items.map(item => `&nbsp;&nbsp;â€¢ ${item.key}: ${item.sizeMB} MB`).join('<br>')}
            `;

            log(`ğŸ“Š ìš©ëŸ‰ í™•ì¸: ${mb} MB (${percentage.toFixed(1)}%)`);
            items.forEach(item => {
                log(`&nbsp;&nbsp;â€¢ ${item.key}: ${item.sizeMB} MB`);
            });
        }

        function backupWorkflow() {
            const data = localStorage.getItem('nano-banana-workflow-v3');
            if (!data) {
                alert('âš ï¸ ì €ì¥ëœ ì›Œí¬í”Œë¡œìš°ê°€ ì—†ìŠµë‹ˆë‹¤!');
                return;
            }

            try {
                // Parse and format
                const parsed = JSON.parse(data);
                const formatted = JSON.stringify(parsed, null, 2);
                
                // Download
                const blob = new Blob([formatted], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `workflow-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);

                log('âœ… ë°±ì—… ì™„ë£Œ!');
                alert('âœ… ë°±ì—…ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
            } catch (error) {
                log(`âŒ ë°±ì—… ì‹¤íŒ¨: ${error.message}`);
                alert('âŒ ë°±ì—… ì‹¤íŒ¨: ' + error.message);
            }
        }

        function clearStorage() {
            if (!confirm('âš ï¸ ì •ë§ localStorageë¥¼ ì •ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në°±ì—…ì„ ë¨¼ì € í•˜ì…¨ë‚˜ìš”?')) {
                return;
            }

            if (!confirm('âš ï¸âš ï¸ ë§ˆì§€ë§‰ í™•ì¸!\n\nëª¨ë“  ì´ë¯¸ì§€ì™€ ì›Œí¬í”Œë¡œìš° ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.\në°±ì—… íŒŒì¼ì´ ìˆë‚˜ìš”?')) {
                return;
            }

            try {
                const keys = Object.keys(localStorage);
                log(`ğŸ—‘ï¸ ${keys.length}ê°œ í•­ëª© ì‚­ì œ ì¤‘...`);
                
                localStorage.clear();
                
                log('âœ… localStorage ì •ë¦¬ ì™„ë£Œ!');
                alert('âœ… ì •ë¦¬ ì™„ë£Œ!\n\nì´ì œ ì•±ì„ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.');
                
                checkStorage();
            } catch (error) {
                log(`âŒ ì •ë¦¬ ì‹¤íŒ¨: ${error.message}`);
                alert('âŒ ì •ë¦¬ ì‹¤íŒ¨: ' + error.message);
            }
        }

        // ìë™ í™•ì¸
        window.onload = function() {
            checkStorage();
            log('ğŸš€ localStorage ì •ë¦¬ ë„êµ¬ ì‹œì‘');
        };
    </script>
</body>
</html>
