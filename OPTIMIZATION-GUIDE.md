# 🚀 NanoBanana 최적화 가이드

안정적이고 빠른 워크플로우 작업을 위한 종합 가이드입니다.

---

## 📊 목차

1. [저장공간 최적화](#저장공간-최적화)
2. [메모리 최적화](#메모리-최적화)
3. [일일 권장 작업](#일일-권장-작업)
4. [주간 권장 작업](#주간-권장-작업)
5. [문제 해결](#문제-해결)
6. [성능 모니터링](#성능-모니터링)

---

## 🗄️ 저장공간 최적화

### 현재 시스템 구조

```
📦 NanoBanana 저장소
├── localStorage (5MB 한계)
│   ├── 워크플로우 구조 (nodes, edges)
│   ├── API 키
│   └── 자동 백업 (최대 3개)
│
└── IndexedDB (수백 MB ~ GB)
    ├── 이미지 (Blob, 자동 압축)
    └── 비디오 (Blob)
```

### ✅ 자동 최적화 기능 (이미 작동 중)

1. **이미지 자동 압축** 🎨
   - 2048px 이상 이미지 → 자동 리사이즈
   - PNG → JPEG 변환 (85% 품질)
   - 평균 60~80% 용량 감소

2. **자동 정리 스케줄** 🧹
   - **매일 1회** 자동 실행
   - 30일 이상 오래된 미디어 자동 삭제
   - 7일 이상 오래된 백업 자동 삭제
   - 첫 실행: 앱 시작 5초 후
   - 이후: 매 시간마다 체크

3. **localStorage 자동 관리** 💾
   - 90% 초과시 자동 경고
   - 긴급 정리 트리거
   - 1초 debounce로 저장 빈도 제어

### 📝 수동 최적화 가이드

#### 1. localStorage 정리 (응급 상황)

**증상:**
- "QuotaExceededError" 에러
- 저장이 안됨
- 노드가 삭제 안됨

**해결:**
```javascript
// 브라우저 콘솔(F12)에서 실행
localStorage.clear()
location.reload()
```

**이후:**
1. Import 버튼으로 백업 파일 불러오기
2. API 키 다시 입력

#### 2. IndexedDB 수동 정리

**특정 기간 미디어 삭제:**
```javascript
// 브라우저 콘솔(F12)에서 실행
import { cleanupOldMedia } from './utils/indexedDB'

// 7일 이상 오래된 것 삭제
await cleanupOldMedia(7)

// 14일 이상 오래된 것 삭제
await cleanupOldMedia(14)
```

**전체 삭제 (주의!):**
```javascript
// 브라우저 콘솔(F12)에서 실행
import { clearAllMedia } from './utils/indexedDB'
await clearAllMedia()
```

---

## 🧠 메모리 최적화

### 노드 개수 가이드

| 노드 개수 | 상태 | 권장 사항 |
|----------|------|----------|
| 0-50개 | ✅ 최적 | 문제 없음 |
| 51-100개 | ⚠️ 주의 | 사용하지 않는 노드 정리 권장 |
| 101개+ | 🚨 위험 | 워크플로우 분리 필수 |

### 워크플로우 분리 전략

**방법 1: 기능별 분리**
```
워크플로우 A: 이미지 생성 파이프라인
워크플로우 B: 비디오 생성 파이프라인
워크플로우 C: 그리드 작업
```

**방법 2: 프로젝트별 분리**
```
프로젝트1.json
프로젝트2.json
프로젝트3.json
```

**실행 방법:**
1. 현재 워크플로우 Export
2. 새로운 탭에서 앱 열기
3. Import로 다른 워크플로우 불러오기

### 이미지 크기 최적화

**권장 이미지 크기:**
- **입력 이미지**: 최대 2048x2048px
- **비디오 프레임**: 최대 1280x720px
- **프로토타입**: 512x512px로 먼저 테스트

**큰 이미지 처리 팁:**
1. Photoshop/GIMP 등으로 사전 리사이즈
2. 온라인 압축 도구 사용: [TinyPNG](https://tinypng.com), [Squoosh](https://squoosh.app)
3. 앱에서 Import 시 자동 압축됨

---

## 📅 일일 권장 작업

### 작업 시작 전 (5분)

```bash
✅ 체크리스트
□ Settings에서 저장공간 확인
  - localStorage < 70%
  - IndexedDB 용량 확인
□ 노드 개수 확인 (50개 미만 권장)
□ 백업 존재 확인 (Backup 버튼)
□ API 키 입력 확인
```

### 작업 중 (주기적)

```bash
✅ 30분마다
□ Save 버튼 클릭 (백업 생성)
□ Export 버튼으로 로컬 파일 저장

✅ 1시간마다
□ 사용하지 않는 노드 삭제
□ 테스트용 노드 정리
```

### 작업 종료 전 (3분)

```bash
✅ 체크리스트
□ Export로 최종 백업 저장
□ 중요 파일은 클라우드에도 백업
  - Google Drive
  - Dropbox
  - GitHub
□ Settings에서 저장공간 확인
```

---

## 📆 주간 권장 작업

### 매주 월요일 (10분)

```bash
✅ 정기 점검
□ Backup 모달에서 오래된 백업 확인
□ IndexedDB 통계 확인
  - 50개 이상 미디어 → 수동 정리 고려
□ 사용하지 않는 워크플로우 정리
□ Export 파일 정리 (오래된 것 삭제)
```

### 매월 1일 (20분)

```bash
✅ 대청소
□ localStorage 초기화 (백업 후)
□ IndexedDB 초기화 (백업 후)
□ 브라우저 캐시 삭제
□ 최신 백업만 유지 (나머지 삭제)
```

---

## 🔧 문제 해결

### 자주 발생하는 문제

#### 1. "QuotaExceededError" 에러

**원인:**
- localStorage가 가득 참 (5MB 초과)

**해결:**
1. Export로 백업
2. localStorage 정리
3. 새로고침 후 Import

**예방:**
- 자동 정리 스케줄러가 작동하는지 확인
- Settings에서 저장공간 주기적 체크

#### 2. 노드가 삭제 안됨

**원인:**
- localStorage 가득 참
- 브라우저 메모리 부족

**해결:**
1. localStorage 정리
2. 브라우저 재시작
3. 노드 개수 줄이기

#### 3. 이미지가 표시 안됨

**원인:**
- IndexedDB 오류
- 이미지 참조 손실

**해결:**
1. 브라우저 콘솔(F12)에서 에러 확인
2. IndexedDB 통계 확인
3. 최악의 경우: IndexedDB 초기화 후 Import

#### 4. 앱이 느려짐

**원인:**
- 노드 너무 많음 (100개+)
- 큰 이미지 너무 많음
- 브라우저 메모리 부족

**해결:**
1. 노드 개수 줄이기 (워크플로우 분리)
2. 사용하지 않는 노드 삭제
3. 브라우저 재시작
4. 다른 탭 닫기

---

## 📈 성능 모니터링

### Settings 모달 활용

```
Settings 버튼 → 실시간 통계 확인

📊 워크플로우 통계
├── 노드 개수
├── 연결 개수
└── 상태 (최적/주의/위험)

💾 저장공간 사용량 (localStorage)
├── 사용률 (%)
├── 사용량 / 한계
└── 경고 메시지

📦 IndexedDB
├── 이미지 개수
├── 비디오 개수
└── 총 용량
```

### 콘솔 로그 모니터링

**브라우저 콘솔(F12)에서 확인:**

```javascript
// 저장공간 상세 분석
import { analyzeStorage } from './utils/storage'
analyzeStorage()

// IndexedDB 통계
import { getStorageStats } from './utils/indexedDB'
await getStorageStats()

// 백업 통계
import { getBackupStats } from './utils/backup'
getBackupStats()
```

### 자동 로그 확인

앱이 자동으로 출력하는 로그:

```
✅ 성공 로그 (초록색)
💾 이미지 저장
📥 이미지 로드
✅ 오래된 미디어 N개 자동 정리됨
✅ 자동 정리 완료

ℹ️ 정보 로그 (파란색)
ℹ️ 자동 정리 스킵 (24시간 미경과)
ℹ️ 이미지 압축 스킵

⚠️ 경고 로그 (노란색)
⚠️ localStorage 90% 초과
⚠️ 이미지 없음: [id]

❌ 에러 로그 (빨간색)
❌ IndexedDB 통계 로드 실패
❌ 자동 정리 실패
❌ 이미지 압축 실패
```

---

## 🎯 핵심 요약

### 매일 해야 할 것 (3가지)

1. **작업 전**: Settings에서 저장공간 확인
2. **작업 중**: 30분마다 Save, 1시간마다 Export
3. **작업 후**: Export로 최종 백업

### 절대 하지 말아야 할 것 (3가지)

1. **Export 없이** localStorage 정리 ❌
2. **백업 없이** 워크플로우 삭제 ❌
3. **노드 100개 이상** 계속 작업 ❌

### 자동으로 되는 것 (안심하세요!)

1. ✅ 이미지 자동 압축 (2048px 초과시)
2. ✅ 오래된 미디어 자동 삭제 (30일 후)
3. ✅ 오래된 백업 자동 삭제 (7일 후)
4. ✅ localStorage 90% 초과시 자동 경고
5. ✅ 5분마다 자동 백업 생성

---

## 📞 추가 도움말

### 문제 발생시

1. **첫 번째**: Export로 백업
2. **두 번째**: 브라우저 콘솔(F12)에서 에러 확인
3. **세 번째**: localStorage 정리
4. **네 번째**: 브라우저 재시작

### 데이터 복구

백업이 있다면 안전합니다!

```
Import 버튼 → JSON 파일 선택 → 복원 완료
```

### 성능 최적화 우선순위

1. **노드 개수 줄이기** (가장 효과적)
2. **이미지 크기 줄이기**
3. **오래된 미디어 정리**
4. **localStorage 정리**
5. **브라우저 재시작**

---

**마지막 업데이트**: 2026-01-27  
**작성자**: NanoBanana Team  
**버전**: 1.0.0

🎉 **즐거운 워크플로우 작업 되세요!**
